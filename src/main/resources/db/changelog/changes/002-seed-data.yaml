# Seed data: run with context shard-a or shard-b so each shard gets its own tenant.
# Password for all seed users: password (BCrypt hash below)
databaseChangeLog:
  - changeSet:
      id: seed-tenant-a
      author: saascore
      context: shard-a
      changes:
        - insert:
            tableName: tenants
            columns:
              - column: { name: id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: name, value: "Tenant A" }
              - column: { name: status, value: "ACTIVE" }
              - column: { name: plan, value: "enterprise" }
              - column: { name: primary_region, value: "region-a" }
              - column: { name: shard_key, value: "shard-a" }
              - column: { name: created_at, valueComputed: "CURRENT_TIMESTAMP" }
  - changeSet:
      id: seed-tenant-b
      author: saascore
      context: shard-b
      changes:
        - insert:
            tableName: tenants
            columns:
              - column: { name: id, value: "b0000000-0000-0000-0000-000000000002" }
              - column: { name: name, value: "Tenant B" }
              - column: { name: status, value: "ACTIVE" }
              - column: { name: plan, value: "pro" }
              - column: { name: primary_region, value: "region-b" }
              - column: { name: shard_key, value: "shard-b" }
              - column: { name: created_at, valueComputed: "CURRENT_TIMESTAMP" }
  - changeSet:
      id: seed-permissions
      author: saascore
      context: shard-a
      changes:
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "tenants:write" }
              - column: { name: description, value: "Create/update tenants" }
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "admin:read" }
              - column: { name: description, value: "Read admin config" }
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "admin:write" }
              - column: { name: description, value: "Write admin config" }
  - changeSet:
      id: seed-permissions-b
      author: saascore
      context: shard-b
      changes:
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "tenants:write" }
              - column: { name: description, value: "Create/update tenants" }
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "admin:read" }
              - column: { name: description, value: "Read admin config" }
        - insert:
            tableName: permissions
            columns:
              - column: { name: code, value: "admin:write" }
              - column: { name: description, value: "Write admin config" }
  - changeSet:
      id: seed-roles-a
      author: saascore
      context: shard-a
      changes:
        - insert:
            tableName: roles
            columns:
              - column: { name: id, value: "a1000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: name, value: "admin" }
        - insert:
            tableName: role_permissions
            columns:
              - column: { name: id, value: "a2000000-0000-0000-0000-000000000001" }
              - column: { name: role_id, value: "a1000000-0000-0000-0000-000000000001" }
              - column: { name: permission_code, value: "tenants:write" }
        - insert:
            tableName: role_permissions
            columns:
              - column: { name: id, value: "a2000000-0000-0000-0000-000000000002" }
              - column: { name: role_id, value: "a1000000-0000-0000-0000-000000000001" }
              - column: { name: permission_code, value: "admin:read" }
        - insert:
            tableName: role_permissions
            columns:
              - column: { name: id, value: "a2000000-0000-0000-0000-000000000003" }
              - column: { name: role_id, value: "a1000000-0000-0000-0000-000000000001" }
              - column: { name: permission_code, value: "admin:write" }
  - changeSet:
      id: seed-users-a
      author: saascore
      context: shard-a
      changes:
        # password: password
        - insert:
            tableName: users
            columns:
              - column: { name: id, value: "a3000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: email, value: "admin@example.com" }
              - column: { name: password_hash, value: "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy" }
              - column: { name: status, value: "ACTIVE" }
              - column: { name: created_at, valueComputed: "CURRENT_TIMESTAMP" }
        - insert:
            tableName: user_roles
            columns:
              - column: { name: id, value: "a4000000-0000-0000-0000-000000000001" }
              - column: { name: user_id, value: "a3000000-0000-0000-0000-000000000001" }
              - column: { name: role_id, value: "a1000000-0000-0000-0000-000000000001" }
  - changeSet:
      id: seed-roles-b
      author: saascore
      context: shard-b
      changes:
        - insert:
            tableName: roles
            columns:
              - column: { name: id, value: "b1000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "b0000000-0000-0000-0000-000000000002" }
              - column: { name: name, value: "admin" }
        - insert:
            tableName: role_permissions
            columns:
              - column: { name: id, value: "b2000000-0000-0000-0000-000000000001" }
              - column: { name: role_id, value: "b1000000-0000-0000-0000-000000000001" }
              - column: { name: permission_code, value: "admin:read" }
  - changeSet:
      id: seed-users-b
      author: saascore
      context: shard-b
      changes:
        # password: password
        - insert:
            tableName: users
            columns:
              - column: { name: id, value: "b3000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "b0000000-0000-0000-0000-000000000002" }
              - column: { name: email, value: "userb@example.com" }
              - column: { name: password_hash, value: "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy" }
              - column: { name: status, value: "ACTIVE" }
              - column: { name: created_at, valueComputed: "CURRENT_TIMESTAMP" }
        - insert:
            tableName: user_roles
            columns:
              - column: { name: id, value: "b4000000-0000-0000-0000-000000000001" }
              - column: { name: user_id, value: "b3000000-0000-0000-0000-000000000001" }
              - column: { name: role_id, value: "b1000000-0000-0000-0000-000000000001" }
  - changeSet:
      id: seed-abac-a
      author: saascore
      context: shard-a
      changes:
        - insert:
            tableName: abac_policies
            columns:
              - column: { name: id, value: "a5000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: permission_code, value: "admin:write" }
              - column: { name: effect, value: "DENY" }
              - column: { name: priority, value: "10" }
              - column: { name: enabled, value: "true" }
              - column: { name: conditions_json, value: '{"plan":"free"}' }
  - changeSet:
      id: seed-flags-a
      author: saascore
      context: shard-a
      changes:
        - insert:
            tableName: feature_flags
            columns:
              - column: { name: id, value: "a6000000-0000-0000-0000-000000000001" }
              - column: { name: tenant_id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: name, value: "new_dashboard" }
              - column: { name: enabled, value: "true" }
              - column: { name: rollout_percentage, value: "100" }
              - column: { name: targeting_json, value: "{}" }
              - column: { name: updated_at, valueComputed: "CURRENT_TIMESTAMP" }
        - insert:
            tableName: feature_flags
            columns:
              - column: { name: id, value: "a6000000-0000-0000-0000-000000000002" }
              - column: { name: tenant_id, value: "a0000000-0000-0000-0000-000000000001" }
              - column: { name: name, value: "beta_feature" }
              - column: { name: enabled, value: "true" }
              - column: { name: rollout_percentage, value: "10" }
              - column: { name: targeting_json, value: '{"role":"admin"}' }
              - column: { name: updated_at, valueComputed: "CURRENT_TIMESTAMP" }
